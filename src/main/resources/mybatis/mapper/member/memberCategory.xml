<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spark.dating.member.MemberCategoryDao">

  <resultMap id="PreferenceCategoryMap" type="PreferenceCategory">
    <id property="pc_no" column="PC_NO"/>
    <result property="pc_type" column="PC_TYPE"/>
    <result property="pc_typenum" column="PC_TYPENUM"/>
    <result property="pc_group" column="PC_GROUP"/>
    <result property="pc_name" column="PC_NAME"/>
    <result property="pc_desc" column="PC_DESC"/>
  </resultMap>

  <resultMap id="PreferenceResponseMap" type="PreferenceResponse">
    <result property="memberNo" column="MEMBER_NO"/>

    <collection property="selfPrefers" 
                ofType = "PreferenceCategory"
                resultMap ="PreferenceCategoryMap"/>

    <collection property="partnerPrefers" 
                ofType="PreferenceCategory" 
                resultMap="PreferenceCategoryMap"/>
  </resultMap>

  <insert id="insertMemberCategories">
    INSERT INTO MEMBERCATEGORY(
      MC_NO, 
      MC_MEMBERNO, 
      MC_PREFERNO, 
      MC_CREATEDAT
    )
    VALUES(
      MEMBERCATEGORY_SEQ.nextval,  
      #{memberNo},            
      #{preferNo},                
      SYSDATE                      
    )
  </insert>

  <select id="getAllCategoryStatic" resultMap="PreferenceCategoryMap">
    SELECT * 
    FROM PREFERENCECATEGORY
  </select>

  <select id = "selectSelfPrefers" parameterType="int" resultMap="PreferenceResponseMap">
    SELECT PC.PC_NO, PC.PC_TYPE, PC.PC_TYPENUM, PC.PC_GROUP, PC.PC_NAME, PC.PC_DESC
    FROM MEMBERCATEGORY MC

    JOIN PREFERENCECATEGORY PC ON MC.MC_PREFERNO = PC.PC_NO
    WHERE MC.MC_MEMBERNO = #{memberNo}
  </select>

  <select id="selectPartnerPrefers" parameterType="int" resultMap="PreferenceResponseMap">
    SELECT PC.PC_NO, PC.PC_TYPE, PC.PC_TYPENUM, PC.PC_GROUP, PC.PC_NAME, PC.PC_DESC
    FROM MEMBERCATEGORY MC

    JOIN PREFERENCECATEGORY PC ON MC.MC_PREFERNO = PC.PC_NO
    WHERE MC.MC_MEMBERNO = #{memberNo}  <!-- partner용 조건 필요시 수정 -->
  </select>

</mapper>

<!-- <insert id="insertMemberCategories" parameterType="map">
    insert all
    <foreach collection="preferNos" item="mp_preferNo">
     into MemberCategory(
       MP_MEMBERNO, MP_PREFERNO, MP_CREATEDAT
     ) 
     values(
      #{mp_memberNo}, #{mp_preferNo}, SYSDATE
     )
    </foreach>
    select 1 from dual
  </insert> -->



<!-- <insert id="insertMemberCategories">
    INSERT INTO MEMBERCATEGORY(MC_MEMBERNO, MC_PREFERNO, MC_CREATEDAT)
    VALUES(#{mp_memberNo}, #{preferNo}, SYSDATE)
</insert> -->